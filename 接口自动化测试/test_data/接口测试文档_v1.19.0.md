# 接口测试文档 v1.19.0

## 版本信息
- **版本号**: v1.19.0
- **生成时间**: 2025-01-27
- **分支对比**: develop vs release/1.19.0
- **主要变更**: 新增捐赠订单管理、扭蛋活动、学校系统等模块

## 新增接口模块

### 1. 捐赠订单管理接口 (DonateOrderController)

#### 1.1 创建捐赠订单
- **接口路径**: `POST /donate/createDonateOrder`
- **接口描述**: 创建捐赠订单
- **请求方式**: POST
- **是否需要认证**: 否 (@PublicApi)
- **频率限制**: 2秒内最多200次请求

**请求参数**:
```json
{
  "amount": "100.50",
  "donorName": "张三",
  "anonymous": false,
  "currency": "USDT",
  "donorType": "individual",
  "donorEmailAddress": "donor@example.com",
  "fundSource": "personal_savings",
  "message": "希望能帮助到更多的孩子",
  "platform": "WEB",
  "donateChannel": "binance_pay",
  "transactionId": "0x1234567890abcdef",
  "networkType": "BSC"
}
```

**参数说明**:
- `amount`: 金额（binance_pay类型时必填），格式：数字，最多8位小数
- `donorName`: 捐赠人姓名（必填），长度1-100字符
- `anonymous`: 是否匿名，默认false
- `currency`: 货币类型（必填），支持：USDT,USDC,BTC,ETH,BNB,BUSD
- `donorType`: 捐赠人类型，可选
- `donorEmailAddress`: 捐赠人邮箱地址（必填），需符合邮箱格式
- `fundSource`: 资金来源，可选
- `message`: 留言，最多500字符
- `platform`: 平台，支持：WEB,MOBILE,APP,WAP，默认WEB
- `donateChannel`: 捐赠渠道（必填），支持：manual,wallet,binance_pay
- `transactionId`: 交易ID（manual类型时必传）
- `networkType`: 网络类型，支持：ETH,BSC

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "orderId": 12345,
    "status": "PENDING",
    "paymentUrl": "https://...",
    "expireTime": 1640995200000
  }
}
```

#### 1.2 查询捐赠订单状态
- **接口路径**: `GET /donate/donateOrderStatus/{orderId}`
- **接口描述**: 查询捐赠订单状态
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)

**路径参数**:
- `orderId`: 订单ID（必填，正整数）

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "orderId": 12345,
    "status": "COMPLETED",
    "amount": "100.50",
    "currency": "USDT",
    "donorName": "张三",
    "createTime": 1640995200000,
    "completeTime": 1640995800000
  }
}
```

#### 1.3 分页获取捐赠订单列表
- **接口路径**: `GET /donate/orders`
- **接口描述**: 分页获取捐赠订单列表
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)

**查询参数**:
- `page`: 页码，默认0
- `size`: 每页数量，默认20，最大100
- `donorName`: 捐赠人姓名，可选
- `startDate`: 开始日期，格式：2024-01-01，可选
- `endDate`: 结束日期，格式：2024-12-31，可选
- `currency`: 币种，可选

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "content": [
      {
        "orderId": 12345,
        "donorName": "张三",
        "amount": "100.50",
        "currency": "USDT",
        "status": "COMPLETED",
        "createTime": 1640995200000
      }
    ],
    "totalElements": 100,
    "totalPages": 5,
    "size": 20,
    "number": 0
  }
}
```

#### 1.4 获取捐赠订单详情
- **接口路径**: `GET /donate/orders/{orderId}`
- **接口描述**: 获取捐赠订单详情
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)

**路径参数**:
- `orderId`: 订单ID（必填，正整数）

#### 1.5 获取网络和币种对应关系
- **接口路径**: `GET /donate/network-currency-mapping`
- **接口描述**: 获取网络和币种对应关系
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "ETH": ["USDT", "USDC", "ETH"],
    "BSC": ["USDT", "USDC", "BNB"],
    "TRC20": ["USDT", "TRX"]
  }
}
```

#### 1.6 获取支付地址
- **接口路径**: `GET /donate/payment-address`
- **接口描述**: 获取支付地址
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)

**查询参数**:
- `networkType`: 网络类型（必填），支持：ETH,BSC
- `currency`: 币种（必填），3-10位大写字母

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "address": "0x1234567890abcdef1234567890abcdef12345678"
  }
}
```

#### 1.7 获取汇率信息
- **接口路径**: `GET /donate/exchange-rate`
- **接口描述**: 获取汇率信息
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)

#### 1.8 获取限额信息
- **接口路径**: `GET /donate/withdraw-limit`
- **接口描述**: 获取限额信息
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)

**查询参数**:
- `coin`: 币种（必填），3-10位大写字母
- `network`: 网络（必填），3-20位大写字母和数字

#### 1.9 取消捐赠订单
- **接口路径**: `POST /donate/orders/{orderId}/cancel`
- **接口描述**: 取消捐赠订单
- **请求方式**: POST
- **是否需要认证**: 否 (@PublicApi)

**路径参数**:
- `orderId`: 订单ID（必填，正整数）

#### 1.10 获取捐赠统计概览
- **接口路径**: `GET /donate/statistics/overview`
- **接口描述**: 获取捐赠统计概览
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)

**查询参数**:
- `topContributorsLimit`: 顶级贡献者返回数量，默认5，最大100

#### 1.11 手动触发捐赠统计
- **接口路径**: `POST /donate/statistics/trigger`
- **接口描述**: 手动触发捐赠统计
- **请求方式**: POST
- **是否需要认证**: 否 (@PublicApi)

#### 1.12 批量更新订单fromAddress字段
- **接口路径**: `POST /donate/orders/update-from-address`
- **接口描述**: 批量更新订单fromAddress字段
- **请求方式**: POST
- **是否需要认证**: 否 (@PublicApi)

#### 1.13 币安支付Webhook回调处理
- **接口路径**: `POST /donate/orders/webhook`
- **接口描述**: 币安支付Webhook回调处理
- **请求方式**: POST
- **是否需要认证**: 否 (@PublicApi)

**请求头**:
- `BinancePay-Signature`: 签名
- `BinancePay-Timestamp`: 时间戳
- `BinancePay-Nonce`: 随机数

### 2. 扭蛋活动相关接口 (GachaActivityController)

#### 2.1 获取扭蛋当前活动信息
- **接口路径**: `GET /activity/gacha/info`
- **接口描述**: 获取扭蛋当前活动信息
- **请求方式**: GET
- **是否需要认证**: 是

**查询参数**:
- `language`: 语言，可选

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "activityId": 1,
    "activityName": "春节扭蛋活动",
    "startTime": 1640995200000,
    "endTime": 1641081600000,
    "status": "ACTIVE",
    "description": "活动描述"
  }
}
```

#### 2.2 获取用户抽奖信息
- **接口路径**: `GET /activity/gacha/user/info`
- **接口描述**: 获取用户抽奖信息
- **请求方式**: GET
- **是否需要认证**: 是

**查询参数**:
- `kidId`: 孩子ID（必填，非负整数）
- `activityId`: 活动ID（必填，非负整数）

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "remainingDraws": 3,
    "totalDraws": 10,
    "shareDraws": 2,
    "dailyDraws": 1,
    "lastDrawTime": 1640995200000
  }
}
```

#### 2.3 分享成功，增加抽奖次数
- **接口路径**: `POST /activity/gacha/share`
- **接口描述**: 分享成功，增加抽奖次数
- **请求方式**: POST
- **是否需要认证**: 是

**查询参数**:
- `kidId`: 孩子ID（必填，非负整数）
- `activityId`: 活动ID（必填，非负整数）

#### 2.4 抽奖
- **接口路径**: `POST /activity/gacha/draw`
- **接口描述**: 抽奖
- **请求方式**: POST
- **是否需要认证**: 是

**查询参数**:
- `kidId`: 孩子ID（必填，非负整数）
- `activityId`: 活动ID（必填，非负整数）

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "rewardId": 123,
    "rewardName": "贴纸包",
    "rewardType": "STICKER",
    "rewardValue": 1,
    "isRare": false
  }
}
```

#### 2.5 扭蛋奖励中心
- **接口路径**: `GET /activity/gacha/rewardCenter`
- **接口描述**: 扭蛋奖励中心
- **请求方式**: GET
- **是否需要认证**: 是

**查询参数**:
- `kidId`: 孩子ID（必填，非负整数）
- `activityId`: 活动ID（必填，非负整数）

### 3. 学校系统相关接口 (SchoolController)

#### 3.1 创建班级
- **接口路径**: `POST /school/class`
- **接口描述**: 创建班级
- **请求方式**: POST
- **是否需要认证**: 是

**请求参数**:
```json
{
  "className": "三年级A班",
  "subject": "英语",
  "room": "301",
  "imageUrl": "https://example.com/class.jpg",
  "teacherUserId": 12345
}
```

**参数说明**:
- `className`: 班级名称（必填）
- `subject`: 学科名称，可选
- `room`: 教室编号，可选
- `imageUrl`: 班级图片URL，可选
- `teacherUserId`: 教师userId（必填）

#### 3.2 获取用户的班级列表
- **接口路径**: `GET /school/class/list`
- **接口描述**: 获取用户的班级列表
- **请求方式**: GET
- **是否需要认证**: 是

**查询参数**:
- `page`: 页码，默认0
- `size`: 每页数量，默认10
- `all`: 是否获取所有班级，可选

#### 3.3 更新班级信息
- **接口路径**: `PUT /school/class/{classId}`
- **接口描述**: 更新班级信息
- **请求方式**: PUT
- **是否需要认证**: 是

**路径参数**:
- `classId`: 班级ID（必填）

#### 3.4 删除班级
- **接口路径**: `DELETE /school/class/{classId}`
- **接口描述**: 删除班级
- **请求方式**: DELETE
- **是否需要认证**: 是

**路径参数**:
- `classId`: 班级ID（必填）

#### 3.5 批量添加学生
- **接口路径**: `POST /school/student/batch`
- **接口描述**: 批量添加学生
- **请求方式**: POST
- **是否需要认证**: 是

**请求参数**:
```json
{
  "classId": 123,
  "studentNames": ["张三", "李四", "王五"]
}
```

**参数说明**:
- `classId`: 班级ID（必填）
- `studentNames`: 学生名称列表（必填）

#### 3.6 获取班级学生列表
- **接口路径**: `GET /school/class/{classId}/students`
- **接口描述**: 获取班级学生列表
- **请求方式**: GET
- **是否需要认证**: 是

**路径参数**:
- `classId`: 班级ID（必填）

**查询参数**:
- `page`: 页码，默认0
- `size`: 每页数量，默认10

#### 3.7 更新学生信息
- **接口路径**: `PUT /school/student/{studentId}`
- **接口描述**: 更新学生信息
- **请求方式**: PUT
- **是否需要认证**: 是

**路径参数**:
- `studentId`: 学生ID（必填）

**请求参数**:
```json
{
  "studentName": "张三",
  "username": "zhangsan",
  "avatarUrl": "https://example.com/avatar.jpg"
}
```

#### 3.8 删除学生
- **接口路径**: `DELETE /school/student/{studentId}`
- **接口描述**: 删除学生
- **请求方式**: DELETE
- **是否需要认证**: 是

**路径参数**:
- `studentId`: 学生ID（必填）

#### 3.9 创建课堂
- **接口路径**: `POST /school/lesson`
- **接口描述**: 创建课堂
- **请求方式**: POST
- **是否需要认证**: 是

**请求参数**:
```json
{
  "lessonName": "英语口语课",
  "classId": 123,
  "teachingLanguage": "en",
  "resources": [
    {
      "resourceType": "BOOK",
      "id": 456
    }
  ]
}
```

#### 3.10 更新课堂信息
- **接口路径**: `PUT /school/lesson/{lessonId}`
- **接口描述**: 更新课堂信息
- **请求方式**: PUT
- **是否需要认证**: 是

#### 3.11 删除课堂
- **接口路径**: `DELETE /school/lesson/{lessonId}`
- **接口描述**: 删除课堂
- **请求方式**: DELETE
- **是否需要认证**: 是

#### 3.12 获取班级课堂列表
- **接口路径**: `GET /school/class/{classId}/lessons`
- **接口描述**: 获取班级课堂列表
- **请求方式**: GET
- **是否需要认证**: 是

**查询参数**:
- `page`: 页码，默认0
- `size`: 每页数量，默认10
- `keyword`: 关键词搜索，可选

#### 3.13 获取课堂详情
- **接口路径**: `GET /school/lesson/{lessonId}`
- **接口描述**: 获取课堂详情
- **请求方式**: GET
- **是否需要认证**: 是

#### 3.14 创建学生分组
- **接口路径**: `POST /school/lesson/{lessonId}/groups`
- **接口描述**: 创建学生分组
- **请求方式**: POST
- **是否需要认证**: 是

**请求参数**:
```json
{
  "groupCount": 4
}
```

#### 3.15 获取课堂学习资源
- **接口路径**: `GET /school/lesson/{lessonId}/resources`
- **接口描述**: 获取课堂学习资源
- **请求方式**: GET
- **是否需要认证**: 是

#### 3.16 获取课堂小组二维码
- **接口路径**: `GET /school/lesson/{lessonId}/qrcode/{groupSeqNo}`
- **接口描述**: 获取课堂小组二维码
- **请求方式**: GET
- **是否需要认证**: 是

**路径参数**:
- `lessonId`: 课堂ID（必填）
- `groupSeqNo`: 小组序号（必填）

#### 3.17 导出学生名单
- **接口路径**: `GET /school/student/export`
- **接口描述**: 导出学生名单
- **请求方式**: GET
- **是否需要认证**: 是

**查询参数**:
- `classId`: 班级ID（必填）

#### 3.18 学生扫码登录
- **接口路径**: `POST /school/student/login/qrcode`
- **接口描述**: 学生扫码登录
- **请求方式**: POST
- **是否需要认证**: 否

**请求参数**:
```json
{
  "studentId": 123
}
```

#### 3.19 Normal课程资源列表
- **接口路径**: `GET /school/lesson/resource/normalCourse`
- **接口描述**: Normal课程资源列表
- **请求方式**: GET
- **是否需要认证**: 否

**查询参数**:
- `page`: 页码，默认0
- `size`: 每页数量，默认10
- `keyword`: 关键词搜索，可选

#### 3.20 测验列表
- **接口路径**: `GET /school/lesson/resource/quiz`
- **接口描述**: 测验列表
- **请求方式**: GET
- **是否需要认证**: 否

**查询参数**:
- `page`: 页码，默认0
- `size`: 每页数量，默认10
- `keyword`: 关键词搜索，可选

## 修改的接口

### 1. 系统信息接口 (SystemController)

#### 1.1 系统健康状态检查
- **接口路径**: `GET /system/health`
- **接口描述**: 系统健康状态检查
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)
- **修改内容**: 新增token参数验证

**查询参数**:
- `token`: 健康检查令牌（必填）

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "status": "UP",
    "timestamp": 1640995200000,
    "isUp": true
  }
}
```

#### 1.2 系统信息检查
- **接口路径**: `GET /system/info`
- **接口描述**: 系统信息检查
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)
- **修改内容**: 新增token参数验证

**查询参数**:
- `token`: 健康检查令牌（必填）

#### 1.3 简单的ping检查
- **接口路径**: `GET /system/ping`
- **接口描述**: 简单的ping检查
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)
- **修改内容**: 新增token参数验证

**查询参数**:
- `token`: 健康检查令牌（必填）

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "message": "pong",
    "timestamp": 1640995200000,
    "server": "giggle-academy-server"
  }
}
```

#### 1.4 获取系统基础信息
- **接口路径**: `GET /system/metadata`
- **接口描述**: 获取系统基础信息
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)
- **修改内容**: 新增接口

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "serverTime": 1640995200000,
    "timeZone": "Asia/Shanghai",
    "timeZoneOffset": 28800000,
    "serverVersion": "0.0.1",
    "serverName": "Giggle Server"
  }
}
```

### 2. 书籍相关接口 (BookController)

#### 2.1 获取支持的所有翻译语言
- **接口路径**: `GET /book/supportedTranslateLanguages`
- **接口描述**: 获取支持的所有翻译语言
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)
- **修改内容**: 新增接口

#### 2.2 触发书籍翻译
- **接口路径**: `POST /book/translation/trigger`
- **接口描述**: 触发书籍翻译
- **请求方式**: POST
- **是否需要认证**: 是
- **修改内容**: 新增接口

**查询参数**:
- `bookIds`: 书籍ID列表，逗号分隔

#### 2.3 获取故事书内单词释义
- **接口路径**: `GET /book/getWordDefinition`
- **接口描述**: 获取故事书内单词释义
- **请求方式**: GET
- **是否需要认证**: 否 (@PublicApi)
- **修改内容**: 新增接口

#### 2.4 根据故事书内容生成AI视频
- **接口路径**: `POST /book/generateVideo`
- **接口描述**: 根据故事书内容生成AI视频
- **请求方式**: POST
- **是否需要认证**: 是
- **修改内容**: 新增接口

#### 2.5 根据故事书ID获取AI视频信息
- **接口路径**: `GET /book/generateVideo`
- **接口描述**: 根据故事书ID获取AI视频信息
- **请求方式**: GET
- **是否需要认证**: 是
- **修改内容**: 新增接口

### 3. 用户相关接口 (UserController)

#### 3.1 获取视频白名单用户列表
- **接口路径**: `GET /user/videoWhitelist/`
- **接口描述**: 获取视频白名单用户列表
- **请求方式**: GET
- **是否需要认证**: 是
- **修改内容**: 新增接口

#### 3.2 视频白名单用户全量更新
- **接口路径**: `POST /user/videoWhitelist/`
- **接口描述**: 视频白名单用户全量更新
- **请求方式**: POST
- **是否需要认证**: 是
- **修改内容**: 新增接口

**请求参数**:
```json
[123, 456, 789]
```

**参数说明**:
- 用户ID列表（必填）

## 测试用例示例

### 捐赠订单创建测试用例

#### 测试用例1: 正常创建Binance Pay订单
```bash
curl -X POST "http://localhost:8080/donate/createDonateOrder" \
  -H "Content-Type: application/json" \
  -d '{
    "amount": "100.50",
    "donorName": "张三",
    "anonymous": false,
    "currency": "USDT",
    "donorEmailAddress": "zhangsan@example.com",
    "donateChannel": "binance_pay",
    "platform": "WEB"
  }'
```

**预期结果**: 返回200状态码，包含订单ID和支付URL

#### 测试用例2: 手动捐赠订单
```bash
curl -X POST "http://localhost:8080/donate/createDonateOrder" \
  -H "Content-Type: application/json" \
  -d '{
    "donorName": "李四",
    "currency": "USDT",
    "donorEmailAddress": "lisi@example.com",
    "donateChannel": "manual",
    "transactionId": "0x1234567890abcdef",
    "networkType": "ETH",
    "message": "支持教育事业"
  }'
```

**预期结果**: 返回200状态码，创建手动捐赠订单

### 扭蛋活动测试用例

#### 测试用例3: 获取活动信息
```bash
curl -X GET "http://localhost:8080/activity/gacha/info?language=zh"
```

**预期结果**: 返回200状态码，包含活动信息

#### 测试用例4: 用户抽奖
```bash
curl -X POST "http://localhost:8080/activity/gacha/draw?kidId=123&activityId=1" \
  -H "Authorization: Bearer <token>"
```

**预期结果**: 返回200状态码，包含抽奖结果

### 学校系统测试用例

#### 测试用例5: 创建班级
```bash
curl -X POST "http://localhost:8080/school/class" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "className": "三年级A班",
    "subject": "英语",
    "room": "301",
    "imageUrl": "https://example.com/class.jpg"
  }'
```

**预期结果**: 返回200状态码，包含班级信息

#### 测试用例6: 批量添加学生
```bash
curl -X POST "http://localhost:8080/school/student/batch" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "classId": 123,
    "studentNames": ["张三", "李四", "王五"]
  }'
```

**预期结果**: 返回200状态码，包含学生列表

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 注意事项

1. **认证要求**: 大部分接口需要Bearer Token认证，请在请求头中添加 `Authorization: Bearer <token>`
2. **频率限制**: 部分接口有频率限制，请遵守限制规则
3. **参数验证**: 所有必填参数都需要提供，可选参数可以省略
4. **数据格式**: 请求和响应数据均为JSON格式
5. **时间格式**: 时间戳使用毫秒级Unix时间戳
6. **分页参数**: 分页接口的page从0开始，size有最大值限制

## 版本更新说明

### v1.19.0 主要更新内容

1. **新增捐赠订单管理模块**: 支持Binance Pay支付、手动捐赠等多种捐赠方式
2. **新增扭蛋活动模块**: 支持抽奖活动、奖励中心等功能
3. **新增学校系统模块**: 支持班级管理、学生管理、课堂管理等功能
4. **优化系统健康检查**: 增加token验证机制
5. **新增书籍翻译功能**: 支持多语言翻译和AI视频生成
6. **新增用户白名单管理**: 支持视频白名单用户管理

### 兼容性说明

- 所有新增接口都向后兼容
- 修改的接口保持原有功能，仅增加新的参数或功能
- 废弃的接口会在后续版本中移除，请及时更新调用方式
