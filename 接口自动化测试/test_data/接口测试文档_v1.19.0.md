# 接口测试文档 v1.19.0

## 1. 版本概述

**版本号**: v1.19.0  
**发布日期**: 2025年1月  
**测试环境**: [待填写]  
**生产环境**: [待填写]  

### 1.1 主要功能更新
- **捐赠订单系统**: 新增币安支付捐赠功能，支持多种支付方式
- **扭蛋活动系统**: 新增完整的扭蛋抽奖活动功能（用户端+管理端）
- **学校管理系统**: 新增班级和学生管理功能，支持课堂、分组、资源管理
- **邮件系统**: 新增邮件推送、退订、统计功能，支持定时发送和用户通知
- **用户留存系统**: 新增用户留存任务和邮件通知功能
- **系统控制器**: 重构健康检查为系统信息接口
- **管理后台**: 新增活动管理功能，支持活动创建、更新、任务定义等

### 1.2 数据库变更
- 新增 `donate_order` 表：捐赠订单
- 新增 `activity` 表：活动基本信息
- 新增 `activity_task_definition` 表：活动任务定义
- 新增 `activity_user_action_log` 表：用户行为记录
- 新增 `school_class` 表：学校班级
- 新增 `school_student` 表：学校学生
- 新增 `school_lesson` 表：学校课堂
- 新增 `school_lesson_resource` 表：课堂资源
- 新增 `school_lesson_student_group` 表：课堂学生分组
- 新增 `user_retention_task` 表：用户留存任务
- 新增 `email_push` 表：邮件推送任务
- 新增 `email_unsubscribe` 表：邮件退订记录
- 修改 `reward_prop` 表：增加活动绑定字段
- 修改 `books_multilingual` 表：增加语音包字段

## 2. 新增接口测试

### 2.1 捐赠订单相关接口 (DonateOrderController)

#### 2.1.1 创建捐赠订单
**接口地址**: `POST /donate/createDonateOrder`  
**接口描述**: 创建新的捐赠订单，支持币安支付、手动支付、钱包支付三种方式  
**请求方式**: POST  
**是否需要认证**: 否 (@PublicApi)  
**控制器**: DonateOrderController.createDonateOrder()  
**频率限制**: 2秒间隔，每天最多200次

**请求参数** (CreateDonateOrderRequest):
```json
{
  "amount": "100.50",
  "donorName": "张三",
  "anonymous": false,
  "currency": "USDT",
  "donorType": "individual",
  "donorEmailAddress": "donor@example.com",
  "fundSource": "personal_savings",
  "message": "希望能帮助到更多的孩子",
  "platform": "WEB",
  "donateChannel": "binance_pay",
  "networkType": "BSC",
  "transactionId": "0x1234567890abcdef"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "orderId": 123456,
    "qrcodeLink": "https://pay.binance.com/qr/xxx",
    "checkoutUrl": "https://pay.binance.com/checkout/xxx",
    "expireTime": "2024-12-31T23:59:59"
  }
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-001 | 正常创建binance_pay订单 | 返回订单信息和支付链接 | P1 |
| DONATE-002 | 创建manual类型订单 | 返回订单ID，无支付链接 | P1 |
| DONATE-003 | 创建wallet类型订单 | 返回订单ID，无支付链接 | P1 |
| DONATE-004 | 金额为空 | 返回参数错误 | P1 |
| DONATE-005 | 邮箱格式错误 | 返回邮箱格式错误 | P1 |
| DONATE-006 | 币种不支持 | 返回币种错误 | P1 |
| DONATE-007 | 匿名捐赠 | 正常创建匿名订单 | P2 |

---

#### 2.1.2 查询捐赠订单状态
**接口地址**: `GET /donate/donateOrderStatus/{orderId}`  
**接口描述**: 查询指定订单的支付状态  
**请求方式**: GET  
**是否需要认证**: 否 (@PublicApi)  
**控制器**: DonateOrderController.getDonateOrderStatus()  

**请求参数**:
| 参数名 | 类型 | 必填 | 验证规则 | 说明 | 示例 |
|--------|------|------|----------|------|------|
| orderId | Long | 是 | @Min(1) | 订单ID | 123456 |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "amount": 100.50,
    "orderId": 123456,
    "paymentStatus": "SUCCESS",
    "name": "张三",
    "currency": "USDT",
    "createTime": "2024-12-01T10:00:00"
  }
}
```

**支付状态说明**:
- PENDING: 待支付
- SUCCESS: 支付成功
- FAILED: 支付失败
- CANCELLED: 已取消
- EXPIRED: 已过期

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-008 | 正常查询订单状态 | 返回订单状态信息 | P1 |
| DONATE-009 | 订单不存在 | 返回订单不存在错误 | P1 |
| DONATE-010 | 订单ID格式错误 | 返回参数错误 | P1 |
| DONATE-011 | 匿名订单查询 | 返回anonymous作为姓名 | P2 |

---

#### 2.1.3 分页获取捐赠订单列表
**接口地址**: `GET /donate/orders`  
**接口描述**: 分页获取捐赠订单列表，支持多种筛选条件  
**请求方式**: GET  
**是否需要认证**: 否 (@PublicApi)  
**控制器**: DonateOrderController.getDonateOrderList()  

**请求参数**:
| 参数名 | 类型 | 必填 | 验证规则 | 说明 | 示例 |
|--------|------|------|----------|------|------|
| page | Int | 否 | @Min(0) | 页码，默认0 | 0 |
| size | Int | 否 | @Min(1) @Max(100) | 每页数量，默认20 | 20 |
| donorName | String | 否 | - | 捐赠人姓名 | 张三 |
| startDate | String | 否 | - | 开始日期 | 2024-01-01 |
| endDate | String | 否 | - | 结束日期 | 2024-12-31 |
| currency | String | 否 | 正则: ^[A-Z]{3,10}$ | 币种 | USDT |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-012 | 正常获取订单列表 | 返回分页订单列表 | P1 |
| DONATE-013 | 按捐赠人姓名筛选 | 返回筛选结果 | P2 |
| DONATE-014 | 按日期范围筛选 | 返回筛选结果 | P2 |
| DONATE-015 | 按币种筛选 | 返回筛选结果 | P2 |
| DONATE-016 | 页码超出范围 | 返回空列表 | P2 |

---

#### 2.1.4 获取捐赠订单详情
**接口地址**: `GET /donate/orders/{orderId}`  
**接口描述**: 获取指定订单的详细信息  
**请求方式**: GET  
**是否需要认证**: 否  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-017 | 正常获取订单详情 | 返回完整订单信息 | P1 |
| DONATE-018 | 订单不存在 | 返回订单不存在错误 | P1 |

---

#### 2.1.5 获取网络和币种对应关系
**接口地址**: `GET /donate/network-currency-mapping`  
**接口描述**: 获取支持的网络和币种对应关系  
**请求方式**: GET  
**是否需要认证**: 否  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-019 | 正常获取映射关系 | 返回网络币种映射 | P2 |

---

#### 2.1.6 获取支付地址
**接口地址**: `GET /donate/payment-address`  
**接口描述**: 获取指定网络和币种的支付地址  
**请求方式**: GET  
**是否需要认证**: 否  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| networkType | String | 是 | 网络类型 | ETH |
| currency | String | 是 | 币种 | USDT |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-020 | 正常获取支付地址 | 返回支付地址 | P2 |
| DONATE-021 | 不支持的网络类型 | 返回错误信息 | P2 |
| DONATE-022 | 不支持的币种 | 返回错误信息 | P2 |

---

#### 2.1.7 获取汇率信息
**接口地址**: `GET /donate/exchange-rate`  
**接口描述**: 获取当前汇率信息  
**请求方式**: GET  
**是否需要认证**: 否  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-023 | 正常获取汇率 | 返回汇率信息 | P2 |

---

#### 2.1.8 获取提现限额
**接口地址**: `GET /donate/withdraw-limit`  
**接口描述**: 获取指定币种和网络的提现限额  
**请求方式**: GET  
**是否需要认证**: 否  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| coin | String | 是 | 币种 | USDT |
| network | String | 是 | 网络 | TRC20 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-024 | 正常获取限额 | 返回限额信息 | P2 |

---

#### 2.1.9 取消捐赠订单
**接口地址**: `POST /donate/orders/{orderId}/cancel`  
**接口描述**: 取消指定的捐赠订单  
**请求方式**: POST  
**是否需要认证**: 否  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-025 | 正常取消订单 | 返回取消成功 | P2 |
| DONATE-026 | 订单不存在 | 返回订单不存在错误 | P1 |
| DONATE-027 | 订单已支付 | 返回无法取消错误 | P2 |

---

#### 2.1.10 币安支付Webhook回调
**接口地址**: `POST /donate/orders/webhook`  
**接口描述**: 处理币安支付的Webhook回调通知，包含签名验证和订单状态更新  
**请求方式**: POST  
**是否需要认证**: 否 (@PublicApi)  
**控制器**: DonateOrderController.handleBinancePayCallback()  

**请求头**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| BinancePay-Signature | String | 是 | 签名，用于验证请求合法性 |
| BinancePay-Timestamp | String | 是 | 时间戳 |
| BinancePay-Nonce | String | 是 | 随机数 |

**业务状态说明**:
- PAY_SUCCESS: 支付成功
- PAY_FAIL: 支付失败
- PAY_CANCEL: 支付取消
- PAY_TIMEOUT: 支付超时

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-028 | 正常支付成功回调 | 返回success，更新订单状态 | P1 |
| DONATE-029 | 签名验证失败 | 返回Invalid signature | P1 |
| DONATE-030 | 支付失败回调 | 返回success，更新订单状态 | P2 |
| DONATE-031 | 支付取消回调 | 返回success，更新订单状态 | P2 |
| DONATE-032 | 无效的JSON格式 | 返回解析错误 | P1 |

---

### 2.2 扭蛋活动相关接口 (GachaActivityController)

#### 2.2.1 获取扭蛋活动信息
**接口地址**: `GET /activity/gacha/info`  
**接口描述**: 获取当前扭蛋活动的基本信息  
**请求方式**: GET  
**是否需要认证**: 否  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| language | String | 否 | 语言代码 | zh-CN |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "activityId": 1,
    "activityName": "扭蛋抽奖",
    "activityStartTime": "2025-08-12T08:00:00",
    "activityEndTime": "2025-08-13T08:00:00",
    "activityStatus": "ACTIVE"
  }
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| GACHA-001 | 正常获取活动信息 | 返回活动基本信息 | P1 |
| GACHA-002 | 活动未开始 | 返回NOT_STARTED状态 | P2 |
| GACHA-003 | 活动已结束 | 返回INACTIVE状态 | P2 |
| GACHA-004 | 多语言支持 | 返回对应语言的活动信息 | P2 |

---

#### 2.2.2 获取用户抽奖信息
**接口地址**: `GET /activity/gacha/user/info`  
**接口描述**: 获取用户在扭蛋活动中的抽奖次数等信息  
**请求方式**: GET  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| kidId | Long | 是 | 孩子ID | 123 |
| activityId | Long | 是 | 活动ID | 1 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| GACHA-005 | 正常获取用户信息 | 返回用户抽奖次数信息 | P1 |
| GACHA-006 | 用户未参与活动 | 返回默认次数信息 | P2 |
| GACHA-007 | 无效的kidId | 返回错误信息 | P1 |
| GACHA-008 | 无效的activityId | 返回错误信息 | P1 |

---

#### 2.2.3 分享成功增加抽奖次数
**接口地址**: `POST /activity/gacha/share`  
**接口描述**: 用户分享成功后增加抽奖次数  
**请求方式**: POST  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| kidId | Long | 是 | 孩子ID | 123 |
| activityId | Long | 是 | 活动ID | 1 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| GACHA-009 | 正常分享 | 增加抽奖次数 | P1 |
| GACHA-010 | 达到分享上限 | 返回限制信息 | P2 |
| GACHA-011 | 重复分享 | 返回已分享信息 | P2 |

---

#### 2.2.4 抽奖
**接口地址**: `POST /activity/gacha/draw`  
**接口描述**: 用户进行扭蛋抽奖  
**请求方式**: POST  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| kidId | Long | 是 | 孩子ID | 123 |
| activityId | Long | 是 | 活动ID | 1 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| GACHA-012 | 正常抽奖 | 返回奖励信息 | P1 |
| GACHA-013 | 抽奖次数不足 | 返回次数不足信息 | P1 |
| GACHA-014 | 活动未开始 | 返回活动未开始信息 | P2 |
| GACHA-015 | 活动已结束 | 返回活动已结束信息 | P2 |

---

#### 2.2.5 扭蛋奖励中心
**接口地址**: `GET /activity/gacha/rewardCenter`  
**接口描述**: 获取用户扭蛋奖励收集情况  
**请求方式**: GET  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| kidId | Long | 是 | 孩子ID | 123 |
| activityId | Long | 是 | 活动ID | 1 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| GACHA-016 | 正常获取奖励中心 | 返回收集情况 | P1 |
| GACHA-017 | 用户无奖励记录 | 返回空列表 | P2 |

---

### 2.3 学校管理系统相关接口 (SchoolController)

#### 2.3.1 创建班级
**接口地址**: `POST /school/class`  
**接口描述**: 创建新的班级  
**请求方式**: POST  
**是否需要认证**: 是  

**请求参数** (SchoolClassReq):
```json
{
  "className": "三年级一班",
  "description": "三年级英语学习班",
  "grade": 3,
  "subject": "English"
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-001 | 正常创建班级 | 返回班级创建成功 | P1 |
| SCHOOL-002 | 空班级名称 | 返回参数错误 | P1 |
| SCHOOL-003 | 重复班级名称 | 返回班级已存在 | P2 |

---

#### 2.3.2 获取用户的班级列表
**接口地址**: `GET /school/class/list`  
**接口描述**: 获取用户的班级列表  
**请求方式**: GET  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| page | Int | 否 | 页码，默认0 | 0 |
| size | Int | 否 | 每页数量，默认10 | 10 |
| all | Boolean | 否 | 是否获取所有班级 | true |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-004 | 正常获取班级列表 | 返回班级列表 | P1 |
| SCHOOL-005 | 获取所有班级 | 返回所有班级 | P2 |

---

#### 2.3.3 更新班级信息
**接口地址**: `PUT /school/class/{classId}`  
**接口描述**: 更新班级信息  
**请求方式**: PUT  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-006 | 正常更新班级 | 返回更新后班级信息 | P1 |
| SCHOOL-007 | 班级不存在 | 返回班级不存在错误 | P1 |

---

#### 2.3.4 删除班级
**接口地址**: `DELETE /school/class/{classId}`  
**接口描述**: 删除班级  
**请求方式**: DELETE  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-008 | 正常删除班级 | 返回删除成功 | P1 |
| SCHOOL-009 | 班级不存在 | 返回班级不存在错误 | P1 |

---

#### 2.3.5 批量添加学生
**接口地址**: `POST /school/student/batch`  
**接口描述**: 批量添加学生  
**请求方式**: POST  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-010 | 正常批量添加学生 | 返回添加成功 | P1 |
| SCHOOL-011 | 空学生列表 | 返回参数错误 | P1 |
| SCHOOL-012 | 重复学生信息 | 返回部分添加成功 | P2 |

---

#### 2.3.6 获取班级学生列表
**接口地址**: `GET /school/class/{classId}/students`  
**接口描述**: 获取班级学生列表  
**请求方式**: GET  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-013 | 正常获取学生列表 | 返回学生列表 | P1 |
| SCHOOL-014 | 班级不存在 | 返回班级不存在错误 | P1 |

---

#### 2.3.7 更新学生信息
**接口地址**: `PUT /school/student/{studentId}`  
**接口描述**: 更新学生信息  
**请求方式**: PUT  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-015 | 正常更新学生 | 返回更新后学生信息 | P1 |
| SCHOOL-016 | 学生不存在 | 返回学生不存在错误 | P1 |

---

#### 2.3.8 删除学生
**接口地址**: `DELETE /school/student/{studentId}`  
**接口描述**: 删除学生  
**请求方式**: DELETE  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-017 | 正常删除学生 | 返回删除成功 | P1 |
| SCHOOL-018 | 学生不存在 | 返回学生不存在错误 | P1 |

---

#### 2.3.9 创建课堂
**接口地址**: `POST /school/lesson`  
**接口描述**: 创建课堂  
**请求方式**: POST  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-019 | 正常创建课堂 | 返回课堂创建成功 | P1 |
| SCHOOL-020 | 空课堂名称 | 返回参数错误 | P1 |

---

#### 2.3.10 更新课堂信息
**接口地址**: `PUT /school/lesson/{lessonId}`  
**接口描述**: 更新课堂信息  
**请求方式**: PUT  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-021 | 正常更新课堂 | 返回更新后课堂信息 | P1 |
| SCHOOL-022 | 课堂不存在 | 返回课堂不存在错误 | P1 |

---

#### 2.3.11 删除课堂
**接口地址**: `DELETE /school/lesson/{lessonId}`  
**接口描述**: 删除课堂  
**请求方式**: DELETE  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-023 | 正常删除课堂 | 返回删除成功 | P1 |
| SCHOOL-024 | 课堂不存在 | 返回课堂不存在错误 | P1 |

---

#### 2.3.12 获取班级课堂列表
**接口地址**: `GET /school/class/{classId}/lessons`  
**接口描述**: 获取班级课堂列表  
**请求方式**: GET  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| classId | Long | 是 | 班级ID | 123 |
| page | Int | 否 | 页码，默认0 | 0 |
| size | Int | 否 | 每页数量，默认10 | 10 |
| keyword | String | 否 | 搜索关键词 | 英语 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-025 | 正常获取课堂列表 | 返回课堂列表 | P1 |
| SCHOOL-026 | 按关键词搜索 | 返回搜索结果 | P2 |

---

#### 2.3.13 获取课堂详情
**接口地址**: `GET /school/lesson/{lessonId}`  
**接口描述**: 获取课堂详情  
**请求方式**: GET  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-027 | 正常获取课堂详情 | 返回课堂详细信息 | P1 |
| SCHOOL-028 | 课堂不存在 | 返回课堂不存在错误 | P1 |

---

#### 2.3.14 创建学生分组
**接口地址**: `POST /school/lesson/{lessonId}/groups`  
**接口描述**: 创建学生分组  
**请求方式**: POST  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| lessonId | Long | 是 | 课堂ID | 123 |
| groupCount | Int | 是 | 分组数量 | 4 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-029 | 正常创建分组 | 返回分组信息 | P1 |
| SCHOOL-030 | 无效分组数量 | 返回参数错误 | P1 |

---

#### 2.3.15 获取课堂学习资源
**接口地址**: `GET /school/lesson/{lessonId}/resources`  
**接口描述**: 获取课堂学习资源  
**请求方式**: GET  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-031 | 正常获取资源列表 | 返回资源列表 | P1 |
| SCHOOL-032 | 课堂不存在 | 返回课堂不存在错误 | P1 |

---

#### 2.3.16 获取课堂小组二维码
**接口地址**: `GET /school/lesson/{lessonId}/qrcode/{groupSeqNo}`  
**接口描述**: 获取课堂小组二维码  
**请求方式**: GET  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-033 | 正常获取二维码 | 返回二维码信息 | P1 |
| SCHOOL-034 | 无效分组序号 | 返回参数错误 | P1 |

---

#### 2.3.17 导出学生名单
**接口地址**: `GET /school/student/export`  
**接口描述**: 导出学生名单  
**请求方式**: GET  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| classId | Long | 是 | 班级ID | 123 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-035 | 正常导出学生名单 | 返回学生导出数据 | P1 |
| SCHOOL-036 | 班级不存在 | 返回班级不存在错误 | P1 |

---

#### 2.3.18 学生扫码登录
**接口地址**: `POST /school/student/login/qrcode`  
**接口描述**: 学生扫码登录  
**请求方式**: POST  
**是否需要认证**: 否  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| studentId | Long | 是 | 学生ID | 123 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-037 | 正常扫码登录 | 返回登录成功信息 | P1 |
| SCHOOL-038 | 学生不存在 | 返回学生不存在错误 | P1 |

---

#### 2.3.19 Normal课程资源列表
**接口地址**: `GET /school/lesson/resource/normalCourse`  
**接口描述**: Normal课程资源列表  
**请求方式**: GET  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| page | Int | 否 | 页码，默认0 | 0 |
| size | Int | 否 | 每页数量，默认10 | 10 |
| keyword | String | 否 | 搜索关键词 | 英语 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-039 | 正常获取课程列表 | 返回课程列表 | P1 |
| SCHOOL-040 | 按关键词搜索 | 返回搜索结果 | P2 |

---

#### 2.3.20 测验列表
**接口地址**: `GET /school/lesson/resource/quiz`  
**接口描述**: 测验列表  
**请求方式**: GET  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| page | Int | 否 | 页码，默认0 | 0 |
| size | Int | 否 | 每页数量，默认10 | 10 |
| keyword | String | 否 | 搜索关键词 | 语法 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-041 | 正常获取测验列表 | 返回测验列表 | P1 |
| SCHOOL-042 | 按关键词搜索 | 返回搜索结果 | P2 |

---

### 2.4 邮件相关接口 (EmailController)

#### 2.4.1 邮件信息统计接口
**接口地址**: `GET /email/statistics`  
**接口描述**: 邮件信息统计接口，用于统计邮件点击次数并重定向  
**请求方式**: GET  
**是否需要认证**: 否 (@PublicApi)  
**控制器**: EmailController.emailInfoStatistics()  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| data | String | 是 | 加密的邮件数据 | encrypted_data_string |
| redirectUrl | String | 是 | 重定向URL | https://example.com |

**响应**: 302重定向到相应URL

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| EMAIL-001 | 正常邮件统计 | 重定向到指定URL，增加点击次数 | P1 |
| EMAIL-002 | 桌面端用户代理 | 重定向到官网URL | P2 |
| EMAIL-003 | 移动端用户代理 | 重定向到原始URL | P2 |
| EMAIL-004 | 无效加密数据 | 返回解密错误 | P1 |

---

#### 2.4.2 邮件取消订阅接口
**接口地址**: `POST /email/unsubscribe`  
**接口描述**: 邮件取消订阅接口，用户可以通过此接口取消邮件订阅  
**请求方式**: POST  
**是否需要认证**: 否 (@PublicApi)  
**控制器**: EmailController.unsubscribeEmail()  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| data | String | 是 | 加密的邮件数据 | encrypted_data_string |
| reason | String | 否 | 取消订阅原因 | 不再需要此类邮件 |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": "Unsubscribed successfully"
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| EMAIL-005 | 正常取消订阅 | 返回取消成功 | P1 |
| EMAIL-006 | 带原因取消订阅 | 返回取消成功，记录原因 | P2 |
| EMAIL-007 | 无效加密数据 | 返回解密错误 | P1 |
| EMAIL-008 | 重复取消订阅 | 更新取消记录 | P2 |

---

### 2.5 用户邮件相关接口修改 (UserController)

#### 2.5.1 发送邮箱验证码接口
**接口地址**: `POST /user/sendEmail`  
**接口描述**: 发送邮箱验证码接口，支持多种场景的邮件发送  
**请求方式**: POST  
**是否需要认证**: 否 (@PublicApi)  
**控制器**: UserController.sendEmail()  
**频率限制**: 10秒间隔，每天最多100次  

**请求参数** (SendEmailReq):
```json
{
  "email": "user@example.com",
  "scene": "REGISTER_EMAIL",
  "token": "captcha_token"
}
```

**邮件场景说明**:
- REGISTER_EMAIL: 注册邮箱验证
- CONFIRM_EMAIL: 确认邮箱
- RESET_PASSWORD: 重置密码
- LOGIN_BY_EMAIL: 邮箱登录
- UPDATE_OLD_EMAIL: 更新旧邮箱
- UPDATE_EMAIL: 更新邮箱

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| EMAIL-009 | 正常发送注册验证码 | 发送成功 | P1 |
| EMAIL-010 | 邮箱格式错误 | 返回邮箱格式错误 | P1 |
| EMAIL-011 | 邮箱已存在(注册场景) | 返回邮箱已存在错误 | P1 |
| EMAIL-012 | 邮箱不存在(重置密码) | 返回邮箱不存在错误 | P1 |
| EMAIL-013 | 验证码发送频率限制 | 返回频率限制错误 | P1 |
| EMAIL-014 | 无效的验证码token | 返回验证码验证失败 | P1 |

---

#### 2.5.2 设置书籍收藏邮件通知
**接口地址**: `POST /user/bookFavoriteEmailNotify`  
**接口描述**: 设置书籍收藏邮件通知开关  
**请求方式**: POST  
**是否需要认证**: 否 (@PublicApi)  
**控制器**: UserController.setBookFavoriteEmailNotify()  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| data | String | 是 | 加密的用户数据 | encrypted_user_data |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| EMAIL-015 | 正常设置邮件通知 | 设置成功 | P2 |
| EMAIL-016 | 禁用邮件通知 | 禁用成功 | P2 |
| EMAIL-017 | 无效加密数据 | 返回解密错误 | P1 |

---

### 2.6 管理后台邮件相关接口 (AdminController)

#### 2.6.1 发送邮件
**接口地址**: `POST /admin/user/sendEmail`  
**接口描述**: 管理员发送邮件接口  
**请求方式**: POST  
**是否需要认证**: 是 (@AdminApi)  
**控制器**: AdminController.sendEmail()  

**请求参数** (AdminSendEmailReq):
```json
{
  "email": "user@example.com",
  "subject": "邮件主题",
  "content": "邮件内容"
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| EMAIL-018 | 正常发送邮件 | 发送成功 | P1 |
| EMAIL-019 | 邮箱格式错误 | 返回邮箱格式错误 | P1 |
| EMAIL-020 | 空邮件内容 | 返回参数错误 | P1 |

---

#### 2.6.2 添加邮件推送任务
**接口地址**: `POST /admin/email/addEmailToPush`  
**接口描述**: 添加邮件推送任务，支持定时发送  
**请求方式**: POST  
**是否需要认证**: 是 (@AdminApi)  
**控制器**: AdminController.addEmailToPush()  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| emailSubject | String | 是 | 邮件主题 | 活动通知 |
| pushType | String | 是 | 推送类型 | IMMEDIATE |
| emailType | String | 是 | 邮件类型 | ACTIVITY |
| targetType | String | 是 | 目标类型 | ALL_USERS |
| targetEmailList | String | 否 | 目标邮箱列表 | user1@example.com,user2@example.com |
| scheduleTime | String | 否 | 定时发送时间 | 2024-12-31T10:00:00 |
| remark | String | 否 | 备注 | 活动推广邮件 |
| file | MultipartFile | 是 | 邮件内容文件 | email_content.html |

**推送类型说明**:
- IMMEDIATE: 立即发送
- SCHEDULED: 定时发送

**邮件类型说明**:
- ACTIVITY: 活动邮件
- NOTIFICATION: 通知邮件
- MARKETING: 营销邮件

**目标类型说明**:
- ALL_USERS: 所有用户
- SPECIFIC_USERS: 指定用户
- USER_GROUP: 用户组

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| EMAIL-021 | 正常添加立即推送任务 | 添加成功 | P1 |
| EMAIL-022 | 添加定时推送任务 | 添加成功 | P1 |
| EMAIL-023 | 指定用户推送 | 添加成功 | P2 |
| EMAIL-024 | 空邮件内容文件 | 返回参数错误 | P1 |
| EMAIL-025 | 无效的定时时间 | 返回时间格式错误 | P1 |

---

#### 2.6.3 查询退订邮件信息
**接口地址**: `GET /admin/email/queryUnsubscribeEmails`  
**接口描述**: 查询退订邮件信息列表  
**请求方式**: GET  
**是否需要认证**: 是 (@AdminApi)  
**控制器**: AdminController.queryUnsubscribeEmails()  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| reason | String | 否 | 退订原因筛选 | 不再需要 |
| page | Int | 否 | 页码，默认0 | 0 |
| pageSize | Int | 否 | 每页数量，默认10 | 10 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| EMAIL-026 | 正常查询退订列表 | 返回退订列表 | P1 |
| EMAIL-027 | 按原因筛选 | 返回筛选结果 | P2 |
| EMAIL-028 | 分页查询 | 返回分页数据 | P2 |

---

#### 2.6.4 查询推送邮件信息
**接口地址**: `GET /admin/email/queryEmailPushList`  
**接口描述**: 查询推送邮件信息列表  
**请求方式**: GET  
**是否需要认证**: 是 (@AdminApi)  
**控制器**: AdminController.queryEmailPushList()  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| page | Int | 否 | 页码，默认0 | 0 |
| pageSize | Int | 否 | 每页数量，默认10 | 10 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| EMAIL-029 | 正常查询推送列表 | 返回推送列表 | P1 |
| EMAIL-030 | 分页查询 | 返回分页数据 | P2 |

---

#### 2.6.5 根据邮件ID查询邮件内容
**接口地址**: `GET /admin/email/getEmailContent/{emailId}`  
**接口描述**: 根据邮件ID查询邮件内容  
**请求方式**: GET  
**是否需要认证**: 是 (@AdminApi)  
**控制器**: AdminController.getEmailContent()  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| emailId | Long | 是 | 邮件ID | 123 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| EMAIL-031 | 正常查询邮件内容 | 返回邮件内容 | P1 |
| EMAIL-032 | 邮件不存在 | 返回邮件不存在错误 | P1 |

---

### 2.7 系统相关接口修改 (SystemController)

#### 2.4.1 系统健康状态检查
**接口地址**: `GET /system/health`  
**接口描述**: 系统健康状态检查  
**请求方式**: GET  
**是否需要认证**: 公开接口（需要token）  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| token | String | 是 | 健康检查token | .}vNfmArRo<#xEr0:v1f7@A]DYXg6WL_?JEUp/>yDH{g?ML |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "status": "UP",
    "timestamp": 1640995200000,
    "isUp": true
  }
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SYS-001 | 正常健康检查 | 返回健康状态 | P1 |
| SYS-002 | 无效token | 返回403禁止访问 | P1 |
| SYS-003 | 系统异常 | 返回503服务不可用 | P1 |

---

#### 2.4.2 系统信息检查
**接口地址**: `GET /system/info`  
**接口描述**: 系统信息检查  
**请求方式**: GET  
**是否需要认证**: 公开接口（需要token）  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| token | String | 是 | 健康检查token | .}vNfmArRo<#xEr0:v1f7@A]DYXg6WL_?JEUp/>yDH{g?ML |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SYS-004 | 正常获取系统信息 | 返回系统信息 | P1 |
| SYS-005 | 无效token | 返回403禁止访问 | P1 |

---

#### 2.4.3 简单的ping检查
**接口地址**: `GET /system/ping`  
**接口描述**: 简单的ping检查  
**请求方式**: GET  
**是否需要认证**: 公开接口（需要token）  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| token | String | 是 | 健康检查token | .}vNfmArRo<#xEr0:v1f7@A]DYXg6WL_?JEUp/>yDH{g?ML |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "message": "pong",
    "timestamp": 1640995200000,
    "server": "giggle-academy-server"
  }
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SYS-006 | 正常ping检查 | 返回pong | P1 |
| SYS-007 | 无效token | 返回403禁止访问 | P1 |

---

#### 2.4.4 获取系统基础信息
**接口地址**: `GET /system/metadata`  
**接口描述**: 获取系统基础信息  
**请求方式**: GET  
**是否需要认证**: 公开接口  

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "serverTime": 1640995200000,
    "timeZone": "Asia/Shanghai",
    "timeZoneOffset": 28800000,
    "serverVersion": "0.0.1",
    "serverName": "Giggle Server"
  }
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SYS-008 | 正常获取系统基础信息 | 返回系统基础信息 | P1 |

---

## 3. 修改接口测试

### 3.1 错误码更新
新增错误码：
- `ACTIVITY_NOT_FOUND(100114)`: 活动不存在
- `ACTIVITY_CODE_EXIST(100115)`: 活动编码已存在
- `ACTIVITY_EXPIRED(100116)`: 活动已过期
- `ACTIVITY_TASK_CODE_EXIST(100117)`: 活动任务编码已存在
- `ACTIVITY_TASK_NOT_FOUND(100118)`: 活动任务不存在
- `ACTIVITY_TASK_SHARE_LIMIT(100119)`: 活动分享任务限制
- `ACTIVITY_TASK_DRAW_LIMIT(100120)`: 活动抽奖任务限制
- `ORDER_NOT_FOUND(100121)`: 订单不存在
- `THIRD_PARTY_ERROR(100122)`: 第三方服务错误
- `PAYMENT_FAILED(100123)`: 支付失败
- `DONATION_AMOUNT_TOO_LOW(100124)`: 捐赠金额低于最低限额
- `DONATION_AMOUNT_TOO_HIGH(100125)`: 捐赠金额超过最高限额
- `TRANSACTION_ID_ALREADY_EXISTS(100126)`: 交易ID已存在

## 4. 数据库测试

### 4.1 新增表结构测试

#### 4.1.1 donate_order表
**表名**: `donate_order`  
**用途**: 存储捐赠订单信息  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| merchant_trade_no | VARCHAR(32) | UNIQUE | 测试商户订单号唯一性 |
| transaction_id | VARCHAR(200) | UNIQUE | 测试交易ID唯一性 |
| amount | DECIMAL(20,8) | NULL | 测试金额精度 |
| currency | VARCHAR(10) | NOT NULL | 测试币种格式 |
| donor_name | VARCHAR(100) | NOT NULL | 测试捐赠人姓名 |
| donor_email_address | VARCHAR(100) | NULL | 测试邮箱格式 |
| payment_status | VARCHAR(20) | DEFAULT 'PENDING' | 测试支付状态 |

#### 4.1.2 activity表
**表名**: `activity`  
**用途**: 存储活动基本信息  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| name | VARCHAR(255) | NOT NULL | 测试活动名称长度限制 |
| activity_code | VARCHAR(50) | UNIQUE | 测试活动编码唯一性 |
| start_time | TIMESTAMP | NOT NULL | 测试时间格式 |
| end_time | TIMESTAMP | NOT NULL | 测试时间格式 |
| config | JSON | NULL | 测试JSON格式 |
| status | ENUM | DEFAULT 'INACTIVE' | 测试枚举值 |

#### 4.1.3 school_class表
**表名**: `school_class`  
**用途**: 存储学校班级信息  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| class_name | VARCHAR(255) | NOT NULL | 测试班级名称 |
| teacher_user_id | BIGINT | NOT NULL | 测试教师用户ID |
| description | TEXT | NULL | 测试描述字段 |
| grade | INT | NULL | 测试年级字段 |
| subject | VARCHAR(100) | NULL | 测试学科字段 |

#### 4.1.4 school_student表
**表名**: `school_student`  
**用途**: 存储学校学生信息  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| student_name | VARCHAR(255) | NOT NULL | 测试学生姓名 |
| class_id | BIGINT | NOT NULL | 测试班级ID外键 |
| student_id | VARCHAR(100) | NULL | 测试学号字段 |
| parent_contact | VARCHAR(100) | NULL | 测试家长联系方式 |

#### 4.1.5 school_lesson表
**表名**: `school_lesson`  
**用途**: 存储学校课堂信息  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| lesson_name | VARCHAR(255) | NOT NULL | 测试课堂名称 |
| class_id | BIGINT | NOT NULL | 测试班级ID外键 |
| lesson_type | VARCHAR(50) | NULL | 测试课堂类型 |
| status | VARCHAR(20) | DEFAULT 'ACTIVE' | 测试状态字段 |

#### 4.1.6 user_retention_task表
**表名**: `user_retention_task`  
**用途**: 存储用户留存任务信息  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| user_id | BIGINT | NOT NULL | 测试用户ID |
| task_type | VARCHAR(50) | NOT NULL | 测试任务类型 |
| status | VARCHAR(20) | DEFAULT 'PENDING' | 测试状态字段 |
| execute_time | TIMESTAMP | NULL | 测试执行时间 |

#### 4.1.7 email_push表
**表名**: `email_push`  
**用途**: 存储邮件推送任务信息  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| email_subject | VARCHAR(255) | NOT NULL | 测试邮件主题 |
| email_type | VARCHAR(50) | NOT NULL | 测试邮件类型 |
| push_type | VARCHAR(20) | NOT NULL | 测试推送类型 |
| target_type | VARCHAR(20) | NOT NULL | 测试目标类型 |
| target_email_list | TEXT | NULL | 测试目标邮箱列表 |
| schedule_time | TIMESTAMP | NULL | 测试定时发送时间 |
| status | VARCHAR(20) | DEFAULT 'PENDING' | 测试状态字段 |

#### 4.1.8 email_unsubscribe表
**表名**: `email_unsubscribe`  
**用途**: 存储邮件退订记录  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| email | VARCHAR(100) | NOT NULL | 测试邮箱地址 |
| email_type | VARCHAR(50) | NOT NULL | 测试邮件类型 |
| reason | VARCHAR(500) | NULL | 测试退订原因 |
| user_id | BIGINT | NULL | 测试用户ID |
| email_id | BIGINT | NULL | 测试邮件ID |

## 5. 性能测试

### 5.1 接口性能要求
| 接口类型 | 响应时间要求 | 并发用户数 | 成功率要求 |
|----------|--------------|------------|------------|
| 查询接口 | < 500ms | 1000 | > 99% |
| 创建接口 | < 1000ms | 500 | > 99% |
| 文件上传 | < 5000ms | 100 | > 95% |
| Webhook回调 | < 200ms | 100 | > 99% |
| 扭蛋抽奖 | < 800ms | 200 | > 99% |
| 学校管理 | < 600ms | 300 | > 99% |
| 邮件推送 | < 2000ms | 50 | > 95% |
| 邮件统计 | < 300ms | 500 | > 99% |

### 5.2 数据库性能测试
- 测试新增表的查询性能
- 测试索引效果
- 测试大数据量下的查询性能
- 测试并发写入性能
- 测试复杂关联查询性能

## 6. 安全测试

### 6.1 输入验证测试
- SQL注入测试
- XSS攻击测试
- 参数篡改测试
- 文件上传安全测试

### 6.2 认证授权测试
- 未认证访问测试
- 权限越权测试
- Token有效性测试
- 学校系统权限隔离测试

### 6.3 支付安全测试
- 支付回调签名验证
- 重复支付测试
- 金额篡改测试
- 订单状态篡改测试

### 6.4 数据安全测试
- 学生信息保护测试
- 捐赠者隐私保护测试
- 敏感数据加密测试
- 邮件数据加密测试
- 用户邮箱信息保护测试

## 7. 兼容性测试

### 7.1 浏览器兼容性
- Chrome (最新版本)
- Firefox (最新版本)
- Safari (最新版本)
- Edge (最新版本)

### 7.2 移动端兼容性
- iOS Safari
- Android Chrome
- 微信内置浏览器

### 7.3 数据库兼容性
- MySQL 8.0
- 字符集：utf8mb4
- 排序规则：utf8mb4_unicode_ci

## 8. 测试环境配置

### 8.1 测试环境要求
- **服务器配置**: 4核8G内存
- **数据库**: MySQL 8.0
- **Redis**: 6.0+
- **Java版本**: 11+
- **Spring Boot版本**: 2.7+

### 8.2 测试数据准备
- 准备测试用户数据
- 准备测试活动数据
- 准备测试订单数据
- 准备测试班级和学生数据
- 准备测试课堂数据
- 准备测试邮件模板数据
- 准备测试邮件推送任务数据
- 准备测试退订记录数据

### 8.3 外部服务配置
- 币安支付API配置
- 邮件服务配置
- 短信服务配置
- 文件存储服务配置
- 邮件推送服务配置

## 9. 测试执行计划

### 9.1 测试阶段
1. **单元测试**: 开发完成后
2. **接口测试**: 功能开发完成后
3. **集成测试**: 所有功能完成后
4. **系统测试**: 集成测试通过后
5. **验收测试**: 系统测试通过后

### 9.2 测试时间安排
- **接口测试**: 4天
- **数据库测试**: 1天
- **性能测试**: 2天
- **安全测试**: 2天
- **兼容性测试**: 1天
- **回归测试**: 1天

## 10. 风险评估

### 10.1 高风险项
- 币安支付集成
- 学校系统权限控制
- 数据库结构变更
- 第三方服务依赖
- 用户留存任务执行

### 10.2 中风险项
- 扭蛋活动逻辑
- 用户行为记录
- 数据迁移
- 邮件通知功能
- 邮件推送服务
- 邮件退订处理

### 10.3 低风险项
- 系统信息接口
- 错误码更新
- 日志记录

## 11. 测试报告模板

### 11.1 测试执行结果
| 测试类型 | 用例总数 | 通过数 | 失败数 | 通过率 |
|----------|----------|--------|--------|--------|
| 捐赠订单接口测试 | 32 | - | - | - |
| 扭蛋活动接口测试 | 17 | - | - | - |
| 学校管理接口测试 | 42 | - | - | - |
| 邮件相关接口测试 | 24 | - | - | - |
| 系统接口测试 | 8 | - | - | - |
| 数据库测试 | 30 | - | - | - |
| 性能测试 | 15 | - | - | - |
| 安全测试 | 20 | - | - | - |
| 兼容性测试 | 12 | - | - | - |
| **总计** | **200** | - | - | - |

### 11.2 缺陷统计
| 严重级别 | 数量 | 状态 |
|----------|------|------|
| P0 | 0 | - |
| P1 | 3 | 已修复 |
| P2 | 2 | 待修复 |
| P3 | 1 | - |

## 12. 附录

### 12.1 相关文档
- API接口文档
- 数据库设计文档
- 部署文档
- 用户手册
- 币安支付集成文档
- 邮件系统集成文档
- 邮件推送服务文档

### 12.2 联系方式
- 测试负责人: [姓名] [邮箱]
- 开发负责人: [姓名] [邮箱]
- 产品负责人: [姓名] [邮箱]

### 12.3 测试工具
- Postman (API测试)
- JMeter (性能测试)
- Burp Suite (安全测试)
- 浏览器开发者工具 (兼容性测试)
- 数据库管理工具
- 监控工具
- 邮件测试工具
- 邮件服务器模拟工具

---

**文档版本**: v1.0  
**创建日期**: 2025年1月  
**最后更新**: 2025年1月  
**审核人**: [姓名]

