# 接口测试文档 v1.19.0

## 1. 版本概述

**版本号**: v1.19.0  
**发布日期**: 2025年1月  
**测试环境**: [待填写]  
**生产环境**: [待填写]  

### 1.1 主要功能更新
- **捐赠订单系统**: 新增币安支付捐赠功能，支持多种支付方式
- **扭蛋活动系统**: 新增完整的扭蛋抽奖活动功能（用户端+管理端）
- **学校管理系统**: 新增班级和学生管理功能
- **AI视频生成**: 新增基于故事书内容生成AI视频功能
- **系统控制器**: 重构健康检查为系统信息接口
- **管理后台**: 新增活动管理功能，支持活动创建、更新、任务定义等

### 1.2 数据库变更
- 新增 `donate_order` 表：捐赠订单
- 新增 `activity` 表：活动基本信息
- 新增 `activity_task_definition` 表：活动任务定义
- 新增 `activity_user_action_log` 表：用户行为记录
- 新增 `school_class` 表：学校班级
- 新增 `school_student` 表：学校学生
- 修改 `reward_prop` 表：增加活动绑定字段
- 修改 `books_multilingual` 表：增加语音包字段

## 2. 新增接口测试

### 2.1 捐赠订单相关接口 (DonateOrderController)

#### 2.1.1 创建捐赠订单
**接口地址**: `POST /donate/createDonateOrder`  
**接口描述**: 创建新的捐赠订单，支持币安支付、手动支付、钱包支付三种方式  
**请求方式**: POST  
**是否需要认证**: 否 (@PublicApi)  

**请求参数**:
```json
{
  "amount": "100.50",
  "donorName": "张三",
  "anonymous": false,
  "currency": "USDT",
  "donorType": "individual",
  "donorEmailAddress": "donor@example.com",
  "fundSource": "personal_savings",
  "message": "希望能帮助到更多的孩子",
  "platform": "WEB",
  "donateChannel": "binance_pay",
  "networkType": "BSC",
  "transactionId": "0x1234567890abcdef"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "orderId": 123456,
    "qrcodeLink": "https://pay.binance.com/qr/xxx",
    "checkoutUrl": "https://pay.binance.com/checkout/xxx",
    "expireTime": "2024-12-31T23:59:59"
  }
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-001 | 正常创建binance_pay订单 | 返回订单信息和支付链接 | P1 |
| DONATE-002 | 创建manual类型订单 | 返回订单ID，无支付链接 | P1 |
| DONATE-003 | 创建wallet类型订单 | 返回订单ID，无支付链接 | P1 |
| DONATE-004 | 金额为空 | 返回参数错误 | P1 |
| DONATE-005 | 邮箱格式错误 | 返回邮箱格式错误 | P1 |

---

#### 2.1.2 查询捐赠订单状态
**接口地址**: `GET /donate/donateOrderStatus/{orderId}`  
**接口描述**: 查询指定订单的支付状态  
**请求方式**: GET  
**是否需要认证**: 否 (@PublicApi)  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| orderId | Long | 是 | 订单ID | 123456 |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "amount": 100.50,
    "orderId": 123456,
    "paymentStatus": "SUCCESS",
    "name": "张三",
    "currency": "USDT",
    "createTime": "2024-12-01T10:00:00"
  }
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-010 | 正常查询订单状态 | 返回订单状态信息 | P1 |
| DONATE-011 | 订单不存在 | 返回订单不存在错误 | P1 |
| DONATE-012 | 订单ID格式错误 | 返回参数错误 | P1 |

---

#### 2.1.3 分页获取捐赠订单列表
**接口地址**: `GET /donate/orders`  
**接口描述**: 分页获取捐赠订单列表，支持多种筛选条件  
**请求方式**: GET  
**是否需要认证**: 否 (@PublicApi)  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| page | Int | 否 | 页码，默认0 | 0 |
| size | Int | 否 | 每页数量，默认20 | 20 |
| donorName | String | 否 | 捐赠人姓名 | 张三 |
| startDate | String | 否 | 开始日期 | 2024-01-01 |
| endDate | String | 否 | 结束日期 | 2024-12-31 |
| currency | String | 否 | 币种 | USDT |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-014 | 正常获取订单列表 | 返回分页订单列表 | P1 |
| DONATE-015 | 按捐赠人姓名筛选 | 返回筛选结果 | P2 |
| DONATE-016 | 按日期范围筛选 | 返回筛选结果 | P2 |

---

#### 2.1.4 获取捐赠订单详情
**接口地址**: `GET /donate/orders/{orderId}`  
**接口描述**: 获取指定订单的详细信息  
**请求方式**: GET  
**是否需要认证**: 否  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-017 | 正常获取订单详情 | 返回完整订单信息 | P1 |
| DONATE-018 | 订单不存在 | 返回订单不存在错误 | P1 |

---

#### 2.1.5 获取网络和币种对应关系
**接口地址**: `GET /donate/network-currency-mapping`  
**接口描述**: 获取支持的网络和币种对应关系  
**请求方式**: GET  
**是否需要认证**: 否  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-019 | 正常获取映射关系 | 返回网络币种映射 | P2 |

---

#### 2.1.6 获取支付地址
**接口地址**: `GET /donate/payment-address`  
**接口描述**: 获取指定网络和币种的支付地址  
**请求方式**: GET  
**是否需要认证**: 否  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| networkType | String | 是 | 网络类型 | ETH |
| currency | String | 是 | 币种 | USDT |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-020 | 正常获取支付地址 | 返回支付地址 | P2 |
| DONATE-021 | 不支持的网络类型 | 返回错误信息 | P2 |

---

#### 2.1.7 获取汇率信息
**接口地址**: `GET /donate/exchange-rate`  
**接口描述**: 获取当前汇率信息  
**请求方式**: GET  
**是否需要认证**: 否  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-022 | 正常获取汇率 | 返回汇率信息 | P2 |

---

#### 2.1.8 获取提现限额
**接口地址**: `GET /donate/withdraw-limit`  
**接口描述**: 获取指定币种和网络的提现限额  
**请求方式**: GET  
**是否需要认证**: 否  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-023 | 正常获取限额 | 返回限额信息 | P2 |

---

#### 2.1.9 取消捐赠订单
**接口地址**: `POST /donate/orders/{orderId}/cancel`  
**接口描述**: 取消指定的捐赠订单  
**请求方式**: POST  
**是否需要认证**: 否  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-024 | 正常取消订单 | 返回取消成功 | P2 |
| DONATE-025 | 订单不存在 | 返回订单不存在错误 | P1 |

---

#### 2.1.10 币安支付Webhook回调
**接口地址**: `POST /donate/orders/webhook`  
**接口描述**: 处理币安支付的Webhook回调通知  
**请求方式**: POST  
**是否需要认证**: 否 (@PublicApi)  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| DONATE-026 | 正常支付成功回调 | 返回success，更新订单状态 | P1 |
| DONATE-027 | 签名验证失败 | 返回Invalid signature | P1 |
| DONATE-028 | 支付失败回调 | 返回success，更新订单状态 | P2 |

---

### 2.2 扭蛋活动相关接口 (GachaActivityController)

#### 2.2.1 获取扭蛋活动信息
**接口地址**: `GET /activity/gacha/info`  
**接口描述**: 获取当前扭蛋活动的基本信息  
**请求方式**: GET  
**是否需要认证**: 否  

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "activityId": 1,
    "activityName": "扭蛋抽奖",
    "activityStartTime": "2025-08-12T08:00:00",
    "activityEndTime": "2025-08-13T08:00:00",
    "activityStatus": "ACTIVE"
  }
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| GACHA-001 | 正常获取活动信息 | 返回活动基本信息 | P1 |
| GACHA-002 | 活动未开始 | 返回NOT_STARTED状态 | P2 |
| GACHA-003 | 活动已结束 | 返回INACTIVE状态 | P2 |

---

#### 2.2.2 获取用户抽奖信息
**接口地址**: `GET /activity/gacha/user/info`  
**接口描述**: 获取用户在扭蛋活动中的抽奖次数等信息  
**请求方式**: GET  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| kidId | Long | 是 | 孩子ID | 123 |
| activityId | Long | 是 | 活动ID | 1 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| GACHA-004 | 正常获取用户信息 | 返回用户抽奖次数信息 | P1 |
| GACHA-005 | 用户未参与活动 | 返回默认次数信息 | P2 |
| GACHA-006 | 无效的kidId | 返回错误信息 | P1 |

---

#### 2.2.3 分享成功增加抽奖次数
**接口地址**: `POST /activity/gacha/share`  
**接口描述**: 用户分享成功后增加抽奖次数  
**请求方式**: POST  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| GACHA-007 | 正常分享 | 增加抽奖次数 | P1 |
| GACHA-008 | 达到分享上限 | 返回限制信息 | P2 |
| GACHA-009 | 重复分享 | 返回已分享信息 | P2 |

---

#### 2.2.4 抽奖
**接口地址**: `POST /activity/gacha/draw`  
**接口描述**: 用户进行扭蛋抽奖  
**请求方式**: POST  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| GACHA-010 | 正常抽奖 | 返回奖励信息 | P1 |
| GACHA-011 | 抽奖次数不足 | 返回次数不足信息 | P1 |
| GACHA-012 | 活动未开始 | 返回活动未开始信息 | P2 |

---

#### 2.2.5 扭蛋奖励中心
**接口地址**: `GET /activity/gacha/rewardCenter`  
**接口描述**: 获取用户扭蛋奖励收集情况  
**请求方式**: GET  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| GACHA-013 | 正常获取奖励中心 | 返回收集情况 | P1 |
| GACHA-014 | 用户无奖励记录 | 返回空列表 | P2 |

---

### 2.3 学校管理系统相关接口 (SchoolController)

#### 2.3.1 创建班级
**接口地址**: `POST /school/class`  
**接口描述**: 创建新的班级  
**请求方式**: POST  
**是否需要认证**: 是  

**请求参数**:
```json
{
  "className": "三年级一班",
  "description": "三年级英语学习班",
  "grade": 3,
  "subject": "English"
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-001 | 正常创建班级 | 返回班级创建成功 | P1 |
| SCHOOL-002 | 空班级名称 | 返回参数错误 | P1 |
| SCHOOL-003 | 重复班级名称 | 返回班级已存在 | P2 |

---

#### 2.3.2 获取用户的班级列表
**接口地址**: `GET /school/class/list`  
**接口描述**: 获取用户的班级列表  
**请求方式**: GET  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| page | Int | 否 | 页码，默认0 | 0 |
| size | Int | 否 | 每页数量，默认10 | 10 |
| all | Boolean | 否 | 是否获取所有班级 | true |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-004 | 正常获取班级列表 | 返回班级列表 | P1 |
| SCHOOL-005 | 获取所有班级 | 返回所有班级 | P2 |

---

#### 2.3.3 更新班级信息
**接口地址**: `PUT /school/class/{classId}`  
**接口描述**: 更新班级信息  
**请求方式**: PUT  
**是否需要认证**: 是  

**请求参数**:
```json
{
  "className": "dd",
  "imageUrl": "https://baidu.com",
  "room": "room1",
  "subject": "english",
  "teacherUserId": 0
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-006 | 正常更新班级 | 返回更新后班级信息 | P1 |
| SCHOOL-007 | 班级不存在 | 返回班级不存在错误 | P1 |

---

#### 2.3.4 删除班级
**接口地址**: `DELETE /school/class/{classId}`  
**接口描述**: 删除班级  
**请求方式**: DELETE  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-008 | 正常删除班级 | 返回删除成功 | P1 |
| SCHOOL-009 | 班级不存在 | 返回班级不存在错误 | P1 |

---

#### 2.3.5 批量添加学生
**接口地址**: `POST /school/student/batch`  
**接口描述**: 批量添加学生  
**请求方式**: POST  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-010 | 正常批量添加学生 | 返回添加成功 | P1 |
| SCHOOL-011 | 空学生列表 | 返回参数错误 | P1 |
| SCHOOL-012 | 重复学生信息 | 返回部分添加成功 | P2 |

---

#### 2.3.6 获取班级学生列表
**接口地址**: `GET /school/class/{classId}/students`  
**接口描述**: 获取班级学生列表  
**请求方式**: GET  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-013 | 正常获取学生列表 | 返回学生列表 | P1 |
| SCHOOL-014 | 班级不存在 | 返回班级不存在错误 | P1 |

---

#### 2.3.7 更新学生信息
**接口地址**: `PUT /school/student/{studentId}`  
**接口描述**: 更新学生信息  
**请求方式**: PUT  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-015 | 正常更新学生 | 返回更新后学生信息 | P1 |
| SCHOOL-016 | 学生不存在 | 返回学生不存在错误 | P1 |

---

#### 2.3.8 删除学生
**接口地址**: `DELETE /school/student/{studentId}`  
**接口描述**: 删除学生  
**请求方式**: DELETE  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SCHOOL-017 | 正常删除学生 | 返回删除成功 | P1 |
| SCHOOL-018 | 学生不存在 | 返回学生不存在错误 | P1 |

---

### 2.4 故事书相关接口修改

#### 2.4.1 获取故事书内单词释义
**接口地址**: `GET /book/getWordDefinition`  
**接口描述**: 获取故事书内单词释义  
**请求方式**: GET  
**是否需要认证**: 公开接口  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| word | String | 是 | 单词 | hello |
| interfaceLanguage | String | 是 | 界面语言 | en |
| learningLanguage | String | 是 | 学习语言 | en |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| BOOK-001 | 获取英文单词释义 | 返回英文释义 | P1 |
| BOOK-002 | 获取中文单词释义 | 返回中文释义 | P1 |
| BOOK-003 | 无效单词 | 返回参数错误 | P1 |

---

#### 2.4.2 根据故事书内容生成AI视频
**接口地址**: `POST /book/generateVideo`  
**接口描述**: 根据故事书内容生成AI视频  
**请求方式**: POST  
**是否需要认证**: 是  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| bookId | Long | 是 | 故事书ID | 123 |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| BOOK-004 | 生成AI视频 | 返回生成任务ID | P1 |
| BOOK-005 | 无效书籍ID | 返回书籍不存在 | P1 |
| BOOK-006 | 无权限书籍 | 返回权限不足 | P1 |

---

#### 2.4.3 根据故事书ID获取AI视频信息
**接口地址**: `GET /book/generateVideo`  
**接口描述**: 根据故事书ID获取AI视频信息  
**请求方式**: GET  
**是否需要认证**: 是  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| BOOK-007 | 获取视频信息 | 返回视频信息 | P1 |
| BOOK-008 | 视频生成中 | 返回生成状态 | P1 |
| BOOK-009 | 无视频信息 | 返回无视频信息 | P1 |

---

### 2.5 系统相关接口修改

#### 2.5.1 系统健康状态检查
**接口地址**: `GET /system/health`  
**接口描述**: 系统健康状态检查  
**请求方式**: GET  
**是否需要认证**: 公开接口（需要token）  

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| token | String | 是 | 健康检查token | .}vNfmArRo<#xEr0:v1f7@A]DYXg6WL_?JEUp/>yDH{g?ML |

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SYS-001 | 正常健康检查 | 返回健康状态 | P1 |
| SYS-002 | 无效token | 返回403禁止访问 | P1 |

---

#### 2.5.2 系统信息检查
**接口地址**: `GET /system/info`  
**接口描述**: 系统信息检查  
**请求方式**: GET  
**是否需要认证**: 公开接口（需要token）  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SYS-003 | 正常获取系统信息 | 返回系统信息 | P1 |
| SYS-004 | 无效token | 返回403禁止访问 | P1 |

---

#### 2.5.3 简单的ping检查
**接口地址**: `GET /system/ping`  
**接口描述**: 简单的ping检查  
**请求方式**: GET  
**是否需要认证**: 公开接口（需要token）  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SYS-005 | 正常ping检查 | 返回pong | P1 |
| SYS-006 | 无效token | 返回403禁止访问 | P1 |

---

#### 2.5.4 获取系统基础信息
**接口地址**: `GET /system/metadata`  
**接口描述**: 获取系统基础信息  
**请求方式**: GET  
**是否需要认证**: 公开接口  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| SYS-007 | 正常获取系统基础信息 | 返回系统基础信息 | P1 |

---

### 2.6 管理后台活动管理接口 (AdminController)

#### 2.6.1 创建活动
**接口地址**: `POST /admin/activity/create`  
**接口描述**: 管理员创建新的活动  
**请求方式**: POST  
**是否需要认证**: 是 (@AdminApi)  

**请求参数**:
```json
{
  "name": "扭蛋抽奖活动",
  "activityCode": "GACHA_2024",
  "startTime": "2024-12-01T08:00:00",
  "endTime": "2024-12-31T23:59:59",
  "config": {
    "defaultDraws": 1,
    "shareMax": 2,
    "normalStickerProbability": 0.7,
    "pointsProbability": 0.3
  },
  "status": "ACTIVE"
}
```

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| ADMIN-001 | 正常创建活动 | 返回活动信息 | P1 |
| ADMIN-002 | 活动编码重复 | 返回编码已存在错误 | P1 |
| ADMIN-003 | 时间格式错误 | 返回参数错误 | P1 |

---

#### 2.6.2 更新活动
**接口地址**: `PUT /admin/activity/{activityId}`  
**接口描述**: 管理员更新活动信息  
**请求方式**: PUT  
**是否需要认证**: 是 (@AdminApi)  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| ADMIN-004 | 正常更新活动 | 返回更新后活动信息 | P1 |
| ADMIN-005 | 活动不存在 | 返回活动不存在错误 | P1 |

---

#### 2.6.3 更新活动状态
**接口地址**: `PUT /admin/activity/status`  
**接口描述**: 管理员更新活动状态  
**请求方式**: PUT  
**是否需要认证**: 是 (@AdminApi)  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| ADMIN-006 | 正常更新状态 | 返回更新后活动信息 | P1 |
| ADMIN-007 | 无效状态值 | 返回状态错误 | P1 |

---

#### 2.6.4 获取活动列表
**接口地址**: `GET /admin/activity/list`  
**接口描述**: 管理员获取活动列表，支持分页和筛选  
**请求方式**: GET  
**是否需要认证**: 是 (@AdminApi)  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| ADMIN-008 | 正常获取列表 | 返回分页活动列表 | P1 |
| ADMIN-009 | 按关键词筛选 | 返回筛选结果 | P2 |

---

#### 2.6.5 获取活动详情
**接口地址**: `GET /admin/activity/{activityId}`  
**接口描述**: 管理员获取指定活动的详细信息  
**请求方式**: GET  
**是否需要认证**: 是 (@AdminApi)  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| ADMIN-010 | 正常获取详情 | 返回活动详细信息 | P1 |
| ADMIN-011 | 活动不存在 | 返回活动不存在错误 | P1 |

---

#### 2.6.6 删除Redis指定key
**接口地址**: `DELETE /admin/redis/key`  
**接口描述**: 删除Redis指定key  
**请求方式**: DELETE  
**是否需要认证**: 是 (@AdminApi)  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| ADMIN-012 | 删除存在的key | 返回删除成功 | P1 |
| ADMIN-013 | 删除不存在的key | 返回key不存在 | P1 |

---

#### 2.6.7 获取屏蔽的课程ID列表
**接口地址**: `GET /admin/course/blockedIds`  
**接口描述**: 获取屏蔽的课程ID列表  
**请求方式**: GET  
**是否需要认证**: 是 (@AdminApi)  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| ADMIN-014 | 正常获取屏蔽列表 | 返回屏蔽课程ID列表 | P1 |

---

#### 2.6.8 更新屏蔽的课程ID列表
**接口地址**: `PUT /admin/course/blockedIds`  
**接口描述**: 更新屏蔽的课程ID列表  
**请求方式**: PUT  
**是否需要认证**: 是 (@AdminApi)  

**测试用例**:
| 用例ID | 测试场景 | 预期结果 | 优先级 |
|--------|----------|----------|--------|
| ADMIN-015 | 正常更新屏蔽列表 | 返回更新成功 | P1 |

---

## 3. 修改接口测试

### 3.1 错误码更新
新增错误码：
- `ACTIVITY_NOT_FOUND(100114)`: 活动不存在
- `ACTIVITY_CODE_EXIST(100115)`: 活动编码已存在
- `ACTIVITY_EXPIRED(100116)`: 活动已过期
- `ACTIVITY_TASK_CODE_EXIST(100117)`: 活动任务编码已存在
- `ACTIVITY_TASK_NOT_FOUND(100118)`: 活动任务不存在
- `ACTIVITY_TASK_SHARE_LIMIT(100119)`: 活动分享任务限制
- `ACTIVITY_TASK_DRAW_LIMIT(100120)`: 活动抽奖任务限制
- `ORDER_NOT_FOUND(100121)`: 订单不存在
- `THIRD_PARTY_ERROR(100122)`: 第三方服务错误
- `PAYMENT_FAILED(100123)`: 支付失败
- `DONATION_AMOUNT_TOO_LOW(100124)`: 捐赠金额低于最低限额
- `DONATION_AMOUNT_TOO_HIGH(100125)`: 捐赠金额超过最高限额
- `TRANSACTION_ID_ALREADY_EXISTS(100126)`: 交易ID已存在

## 4. 数据库测试

### 4.1 新增表结构测试

#### 4.1.1 donate_order表
**表名**: `donate_order`  
**用途**: 存储捐赠订单信息  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| merchant_trade_no | VARCHAR(32) | UNIQUE | 测试商户订单号唯一性 |
| transaction_id | VARCHAR(200) | UNIQUE | 测试交易ID唯一性 |
| amount | DECIMAL(20,8) | NULL | 测试金额精度 |
| currency | VARCHAR(10) | NOT NULL | 测试币种格式 |
| donor_name | VARCHAR(100) | NOT NULL | 测试捐赠人姓名 |
| donor_email_address | VARCHAR(100) | NULL | 测试邮箱格式 |
| payment_status | VARCHAR(20) | DEFAULT 'PENDING' | 测试支付状态 |

#### 4.1.2 activity表
**表名**: `activity`  
**用途**: 存储活动基本信息  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| name | VARCHAR(255) | NOT NULL | 测试活动名称长度限制 |
| activity_code | VARCHAR(50) | UNIQUE | 测试活动编码唯一性 |
| start_time | TIMESTAMP | NOT NULL | 测试时间格式 |
| end_time | TIMESTAMP | NOT NULL | 测试时间格式 |
| config | JSON | NULL | 测试JSON格式 |
| status | ENUM | DEFAULT 'INACTIVE' | 测试枚举值 |

#### 4.1.3 school_class表
**表名**: `school_class`  
**用途**: 存储学校班级信息  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| class_name | VARCHAR(255) | NOT NULL | 测试班级名称 |
| teacher_user_id | BIGINT | NOT NULL | 测试教师用户ID |
| description | TEXT | NULL | 测试描述字段 |
| grade | INT | NULL | 测试年级字段 |
| subject | VARCHAR(100) | NULL | 测试学科字段 |

#### 4.1.4 school_student表
**表名**: `school_student`  
**用途**: 存储学校学生信息  

**字段测试**:
| 字段名 | 类型 | 约束 | 测试用例 |
|--------|------|------|----------|
| id | BIGINT | PRIMARY KEY | 测试主键唯一性 |
| student_name | VARCHAR(255) | NOT NULL | 测试学生姓名 |
| class_id | BIGINT | NOT NULL | 测试班级ID外键 |
| student_id | VARCHAR(100) | NULL | 测试学号字段 |
| parent_contact | VARCHAR(100) | NULL | 测试家长联系方式 |

## 5. 性能测试

### 5.1 接口性能要求
| 接口类型 | 响应时间要求 | 并发用户数 | 成功率要求 |
|----------|--------------|------------|------------|
| 查询接口 | < 500ms | 1000 | > 99% |
| 创建接口 | < 1000ms | 500 | > 99% |
| 文件上传 | < 5000ms | 100 | > 95% |
| Webhook回调 | < 200ms | 100 | > 99% |

### 5.2 数据库性能测试
- 测试新增表的查询性能
- 测试索引效果
- 测试大数据量下的查询性能
- 测试并发写入性能

## 6. 安全测试

### 6.1 输入验证测试
- SQL注入测试
- XSS攻击测试
- 参数篡改测试
- 文件上传安全测试

### 6.2 认证授权测试
- 未认证访问测试
- 权限越权测试
- Token有效性测试

### 6.3 支付安全测试
- 支付回调签名验证
- 重复支付测试
- 金额篡改测试

## 7. 兼容性测试

### 7.1 浏览器兼容性
- Chrome (最新版本)
- Firefox (最新版本)
- Safari (最新版本)
- Edge (最新版本)

### 7.2 移动端兼容性
- iOS Safari
- Android Chrome
- 微信内置浏览器

### 7.3 数据库兼容性
- MySQL 8.0
- 字符集：utf8mb4
- 排序规则：utf8mb4_unicode_ci

## 8. 测试环境配置

### 8.1 测试环境要求
- **服务器配置**: 4核8G内存
- **数据库**: MySQL 8.0
- **Redis**: 6.0+
- **Java版本**: 11+
- **Spring Boot版本**: 2.7+

### 8.2 测试数据准备
- 准备测试用户数据
- 准备测试活动数据
- 准备测试订单数据
- 准备测试文件数据

## 9. 测试执行计划

### 9.1 测试阶段
1. **单元测试**: 开发完成后
2. **接口测试**: 功能开发完成后
3. **集成测试**: 所有功能完成后
4. **系统测试**: 集成测试通过后
5. **验收测试**: 系统测试通过后

### 9.2 测试时间安排
- **接口测试**: 2天
- **数据库测试**: 1天
- **性能测试**: 1天
- **安全测试**: 1天
- **兼容性测试**: 1天
- **回归测试**: 1天

## 10. 风险评估

### 10.1 高风险项
- 币安支付集成
- 文件上传功能
- 数据库结构变更
- 第三方服务依赖

### 10.2 中风险项
- 扭蛋活动逻辑
- 用户行为记录
- 数据迁移

### 10.3 低风险项
- 系统信息接口
- 错误码更新

## 11. 测试报告模板

### 11.1 测试执行结果
| 测试类型 | 用例总数 | 通过数 | 失败数 | 通过率 |
|----------|----------|--------|--------|--------|
| 捐赠订单接口测试 | 28 | - | - | - |
| 扭蛋活动接口测试 | 14 | - | - | - |
| 学校管理接口测试 | 18 | - | - | - |
| 故事书接口测试 | 9 | - | - | - |
| 系统接口测试 | 7 | - | - | - |
| 管理后台接口测试 | 15 | - | - | - |
| 数据库测试 | 20 | - | - | - |
| 性能测试 | 10 | - | - | - |
| 安全测试 | 15 | - | - | - |
| 兼容性测试 | 12 | - | - | - |
| **总计** | **148** | - | - | - |

### 11.2 缺陷统计
| 严重级别 | 数量 | 状态 |
|----------|------|------|
| P0 | 0 | - |
| P1 | 2 | 已修复 |
| P2 | 1 | 待修复 |
| P3 | 0 | - |

## 12. 附录

### 12.1 相关文档
- API接口文档
- 数据库设计文档
- 部署文档
- 用户手册

### 12.2 联系方式
- 测试负责人: [姓名] [邮箱]
- 开发负责人: [姓名] [邮箱]
- 产品负责人: [姓名] [邮箱]

---

**文档版本**: v1.0  
**创建日期**: 2025年1月  
**最后更新**: 2025年1月  
**审核人**: [姓名]